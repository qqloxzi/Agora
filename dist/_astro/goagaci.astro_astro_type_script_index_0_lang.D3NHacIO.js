import{s as p}from"./supabase.DgUM0jQD.js";const f=["Kurallar","Esir Alma 1","Ä°ki GÃ¶z KavramÄ±","Nefes YarÄ±ÅŸÄ±","Tesuji 1","Oyunu Bitirme","Ã–lÃ¼m & KalÄ±m 1","AÃ§Ä±lÄ±ÅŸ Prensipleri 1","AÃ§Ä±lÄ±ÅŸ Prensipleri 2","Sente","Åekil","Ko SavaÅŸÄ±","AÃ§Ä±lÄ±ÅŸ","Joseki","Ä°stila","SaldÄ±rÄ±","Sayma","Yose","Dan Seviyesi"],g={stone:new Audio("/sounds/stone.mp3"),correct:new Audio("/sounds/correct.mp3"),wrong:new Audio("/sounds/wrong.mp3")};g.stone.volume=.8;g.correct.volume=.6;g.wrong.volume=.5;function a(t){const e=g[t];e&&(e.currentTime=0,e.play().catch(n=>console.log("Ses hatasÄ±:",n)))}let i=[],c=0,d=0,m=!1,y="",r=JSON.parse(localStorage.getItem("completedSets")||"[]"),v=null;document.addEventListener("DOMContentLoaded",async()=>{await B(),h(),b(),L()});async function B(){const{data:{user:t}}=await p.auth.getUser();if(v=t,t){const{data:e}=await p.from("user_progress").select("category_id").eq("user_id",t.id);if(e){const n=e.map(o=>o.category_id);r=[...new Set([...r,...n])],localStorage.setItem("completedSets",JSON.stringify(r))}}}async function S(t){r.includes(t)||(r.push(t),localStorage.setItem("completedSets",JSON.stringify(r))),v&&await p.from("user_progress").insert({user_id:v.id,category_id:t})}function b(){document.querySelectorAll(".level-card").forEach(s=>{s.addEventListener("click",function(){const l=this.getAttribute("data-id")||"",u=this.getAttribute("data-parent");window.tryOpenLevel(l,u,this.id)})});const t=document.getElementById("back-to-map-btn");t&&t.addEventListener("click",window.goToMap);const e=document.getElementById("retry-level-btn");e&&e.addEventListener("click",window.retryLevel);const n=document.getElementById("nav-back-btn");n&&n.addEventListener("click",window.goToMap);const o=document.getElementById("problem-container");o&&o.addEventListener("mousedown",function(s){const l=s.target;l.closest(".go-app.locked")||l&&l.tagName==="CANVAS"&&l.classList.contains("goBoard")&&a("stone")})}function L(){document.addEventListener("click",function(t){const e=t.target;if(!e)return;const n=e.closest("button");n&&(n.classList.contains("prev-btn")?window.navigate(-1):n.classList.contains("hint-btn")?window.showHint(c):n.classList.contains("next-btn")&&!n.disabled&&window.navigate(1))})}function h(){document.querySelectorAll(".level-card").forEach(e=>{const n=e.getAttribute("data-id")||"",o=e.getAttribute("data-parent");e.classList.remove("locked","unlocked","completed"),r.includes(n)?e.classList.add("completed"):o==="null"||o===null||r.includes(o)?e.classList.add("unlocked"):e.classList.add("locked")})}window.tryOpenLevel=function(t,e,n){if(e==="null"||e===null||r.includes(e))window.openLevel(t);else{const s=document.getElementById(n);s&&(a("wrong"),s.classList.add("shake-lock"),setTimeout(()=>s.classList.remove("shake-lock"),500))}};window.openLevel=function(t){y=t,document.getElementById("level-map").style.display="none",document.getElementById("game-view").style.display="block";const e=document.getElementById("current-set-title");e&&(e.innerText=t.toUpperCase()),d=0;const n=document.getElementById("live-score");n&&(n.innerText="Puan: 0"),window.filterSet(t)};window.goToMap=function(){document.getElementById("result-modal").style.display="none",document.getElementById("game-view").style.display="none",document.getElementById("level-map").style.display="grid",h(),window.scrollTo({top:0,behavior:"smooth"})};window.retryLevel=function(){document.getElementById("result-modal").style.display="none",window.openLevel(y)};window.handleMoveResult=function(t){t?setTimeout(()=>a("correct"),400):(m=!0,setTimeout(()=>a("wrong"),400))};window.filterSet=function(t){if(i=Array.from(document.querySelectorAll(".problem-card")).filter(n=>n.getAttribute("data-category")===t),i.length===0){alert(`"${t}" seti boÅŸ!`),window.goToMap();return}i.forEach(n=>{const o=n.querySelector(".resetBtn");o&&o.click()}),c=0,m=!1,i.forEach((n,o)=>{const s=n.querySelector(".count-badge");s&&(s.innerText=`Soru ${o+1} / ${i.length}`);const l=n.querySelector(".next-btn");l&&(l.disabled=!0,l.style.opacity="0.5",l.classList.remove("glow-animation"),l.innerHTML=o===i.length-1?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>')}),k()};function k(){document.querySelectorAll(".problem-card").forEach(e=>e.style.display="none");const t=i[c];t&&(t.style.display="block"),document.querySelectorAll(".hint-display").forEach(e=>{e.style.opacity="0",e.innerHTML=""})}window.navigate=function(t){const e=c+t;if(!m&&t===1){d++;const n=document.getElementById("live-score");n&&(n.innerText=`Puan: ${d}`)}if(c===i.length-1&&t===1){window.showResults();return}e>=0&&e<i.length&&(c=e,m=!1,k())};window.showResults=function(){const t=document.getElementById("result-modal"),e=document.getElementById("result-title"),n=document.getElementById("result-message"),o=document.getElementById("result-icon"),s=document.getElementById("next-level-btn"),l=i.length;document.getElementById("final-score").innerText=String(d),document.getElementById("total-questions").innerText=String(l);const u=Math.ceil(l*.8);if(t&&e&&n&&o&&s){if(d>=u){a("correct"),e.innerText="Set TamamlandÄ±!",e.style.color="#2ecc71",n.innerText="Tebrikler! Bir sonraki seviye aÃ§Ä±ldÄ±.",o.innerText="ğŸ†",S(y);const w=f.indexOf(y);if(w!==-1&&w<f.length-1){const E=f[w+1];s.style.display="inline-block",s.onclick=function(){t.style.display="none",window.openLevel(E)}}else s.style.display="none"}else a("wrong"),e.innerText="BaÅŸarÄ±sÄ±z",e.style.color="#e74c3c",n.innerText=`GeÃ§mek iÃ§in en az ${u} doÄŸru yapmalÄ±sÄ±n.`,o.innerText="âŒ",s.style.display="none";t.style.display="flex"}};window.showHint=function(t){const n=i[c].querySelector(".hint-display");n&&(n.style.opacity==="1"?(n.style.opacity="0",setTimeout(()=>{n.innerHTML=""},300)):(n.innerHTML='<span class="hint-icon">ğŸ’¡</span> <strong>Ä°pucu:</strong> Hamleni yapmadan Ã¶nce 2 adÄ±m sonrasÄ±nÄ± dÃ¼ÅŸÃ¼n.',n.style.opacity="1"))};window.unlockNextButton=function(){const t=i[c];if(t){const e=t.querySelector(".next-btn");e&&(e.disabled=!1,e.style.opacity="1",e.style.cursor="pointer",e.classList.add("glow-animation"))}};
