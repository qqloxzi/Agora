import{s as p}from"./supabase.DgUM0jQD.js";const f=["Kurallar","Esir Alma 1","Ä°ki GÃ¶z KavramÄ±","Nefes YarÄ±ÅŸÄ±","Tesuji 1","Oyunu Bitirme","Ã–lÃ¼m & KalÄ±m 1","AÃ§Ä±lÄ±ÅŸ Prensipleri 1","AÃ§Ä±lÄ±ÅŸ Prensipleri 2","Sente","Åekil","Ko SavaÅŸÄ±","AÃ§Ä±lÄ±ÅŸ","Joseki","Ä°stila","SaldÄ±rÄ±","Sayma","Yose","Dan Seviyesi"],w={stone:new Audio("/sounds/stone.mp3"),correct:new Audio("/sounds/correct.mp3"),wrong:new Audio("/sounds/wrong.mp3")};w.stone.volume=.8;w.correct.volume=.6;w.wrong.volume=.5;function a(t){const e=w[t];e&&(e.currentTime=0,e.play().catch(n=>console.log("Ses hatasÄ±:",n)))}let i=[],c=0,u=0,m=!1,g="",r=JSON.parse(localStorage.getItem("completedSets")||"[]"),v=null;document.addEventListener("DOMContentLoaded",async()=>{await b(),h(),S(),L(),window.addEventListener("unlock-next-problem",()=>{window.unlockNextButton()})});async function b(){const{data:{user:t}}=await p.auth.getUser();if(v=t,t){const{data:e}=await p.from("user_progress").select("category_id").eq("user_id",t.id);if(e){const n=e.map(s=>s.category_id);r=[...new Set([...r,...n])],localStorage.setItem("completedSets",JSON.stringify(r))}}}async function E(t){r.includes(t)||(r.push(t),localStorage.setItem("completedSets",JSON.stringify(r))),v&&await p.from("user_progress").insert({user_id:v.id,category_id:t})}function S(){document.querySelectorAll(".level-card").forEach(l=>{l.addEventListener("click",function(){const o=this.getAttribute("data-id")||"",d=this.getAttribute("data-parent");window.tryOpenLevel(o,d,this.id)})});const t=document.getElementById("back-to-map-btn");t&&t.addEventListener("click",window.goToMap);const e=document.getElementById("retry-level-btn");e&&e.addEventListener("click",window.retryLevel);const n=document.getElementById("nav-back-btn");n&&n.addEventListener("click",window.goToMap);const s=document.getElementById("problem-container");s&&s.addEventListener("mousedown",function(l){const o=l.target;o.closest(".go-app.locked")||o&&o.tagName==="CANVAS"&&o.classList.contains("goBoard")&&a("stone")})}function L(){document.addEventListener("click",function(t){const e=t.target;if(!e)return;const n=e.closest("button");n&&(n.classList.contains("prev-btn")?window.navigate(-1):n.classList.contains("next-btn")&&!n.disabled&&window.navigate(1))})}function h(){document.querySelectorAll(".level-card").forEach(e=>{const n=e.getAttribute("data-id")||"",s=e.getAttribute("data-parent");e.classList.remove("locked","unlocked","completed"),r.includes(n)?e.classList.add("completed"):s==="null"||s===null||r.includes(s)?e.classList.add("unlocked"):e.classList.add("locked")})}window.tryOpenLevel=function(t,e,n){if(e==="null"||e===null||r.includes(e))window.openLevel(t);else{const l=document.getElementById(n);l&&(a("wrong"),l.classList.add("shake-lock"),setTimeout(()=>l.classList.remove("shake-lock"),500))}};window.openLevel=function(t){g=t,document.getElementById("level-map").style.display="none",document.getElementById("game-view").style.display="block";const e=document.getElementById("current-set-title");e&&(e.innerText=t.toUpperCase()),u=0;const n=document.getElementById("live-score");n&&(n.innerText="Puan: 0"),window.filterSet(t)};window.goToMap=function(){document.getElementById("result-modal").style.display="none",document.getElementById("game-view").style.display="none",document.getElementById("level-map").style.display="grid",h(),window.scrollTo({top:0,behavior:"smooth"})};window.retryLevel=function(){document.getElementById("result-modal").style.display="none",window.openLevel(g)};window.handleMoveResult=function(t){t?(setTimeout(()=>a("correct"),400),window.unlockNextButton()):(m=!0,setTimeout(()=>a("wrong"),400))};window.filterSet=function(t){if(i=Array.from(document.querySelectorAll(".problem-card")).filter(n=>n.getAttribute("data-category")===t),i.length===0){alert(`"${t}" seti boÅŸ!`),window.goToMap();return}i.forEach(n=>{const s=n.querySelector(".resetBtn");s&&s.click()}),c=0,m=!1,i.forEach((n,s)=>{const l=n.querySelector(".count-badge");l&&(l.innerText=`Soru ${s+1} / ${i.length}`);const o=n.querySelector(".next-btn");o&&(n.getAttribute("data-has-solution")==="true"?(o.disabled=!0,o.style.opacity="0.5",o.classList.remove("glow-animation"),o.style.cursor="not-allowed"):(o.disabled=!1,o.style.opacity="1",o.classList.remove("glow-animation"),o.style.cursor="pointer"),o.innerHTML=s===i.length-1?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>')}),k()};function k(){document.querySelectorAll(".problem-card").forEach(e=>e.style.display="none");const t=i[c];t&&(t.style.display="block")}window.navigate=function(t){const e=c+t;if(!m&&t===1){u++;const n=document.getElementById("live-score");n&&(n.innerText=`Puan: ${u}`)}if(c===i.length-1&&t===1){window.showResults();return}e>=0&&e<i.length&&(c=e,m=!1,k())};window.showResults=function(){const t=document.getElementById("result-modal"),e=document.getElementById("result-title"),n=document.getElementById("result-message"),s=document.getElementById("result-icon"),l=document.getElementById("next-level-btn"),o=i.length;document.getElementById("final-score").innerText=String(u),document.getElementById("total-questions").innerText=String(o);const d=Math.ceil(o*.8);if(t&&e&&n&&s&&l){if(u>=d){a("correct"),e.innerText="Set TamamlandÄ±!",e.style.color="#2ecc71",n.innerText="Tebrikler! Bir sonraki seviye aÃ§Ä±ldÄ±.",s.innerText="ğŸ†",E(g);const y=f.indexOf(g);if(y!==-1&&y<f.length-1){const B=f[y+1];l.style.display="inline-block",l.onclick=function(){t.style.display="none",window.openLevel(B)}}else l.style.display="none"}else a("wrong"),e.innerText="BaÅŸarÄ±sÄ±z",e.style.color="#e74c3c",n.innerText=`GeÃ§mek iÃ§in en az ${d} doÄŸru yapmalÄ±sÄ±n.`,s.innerText="âŒ",l.style.display="none";t.style.display="flex"}};window.unlockNextButton=function(){const t=i[c];if(t){const e=t.querySelector(".next-btn");e&&(e.disabled=!1,e.style.opacity="1",e.style.cursor="pointer",e.classList.add("glow-animation"))}};
