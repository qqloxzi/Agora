import{j as e,G as J}from"./GoBoardReact.BhtI4yqs.js";import{r as n}from"./index.DiEladB3.js";import{s as w}from"./supabase.DgUM0jQD.js";const T=[{title:"BaÅŸlangÄ±Ã§ (20-18k)",levels:[{id:"Kurallar",label:"Kurallar",icon:"ðŸ“–",parent:null},{id:"Esir Alma 1",label:"Esir Alma 1",icon:"ðŸŒ‘",parent:"Kurallar"},{id:"Ä°ki GÃ¶z KavramÄ±",label:"Ä°ki GÃ¶z",icon:"ðŸ‘€",parent:"Esir Alma 1"},{id:"Nefes YarÄ±ÅŸÄ±",label:"Nefes YarÄ±ÅŸÄ±",icon:"ðŸƒ",parent:"Ä°ki GÃ¶z KavramÄ±"},{id:"Tesuji 1",label:"Tesuji 1",icon:"âš¡",parent:"Nefes YarÄ±ÅŸÄ±"}]},{title:"Temel TaÅŸlar (17-12k)",levels:[{id:"Ã–lÃ¼m & KalÄ±m 1",label:"Ã–lÃ¼m & KalÄ±m",icon:"ðŸ’€",parent:null},{id:"AÃ§Ä±lÄ±ÅŸ Prensipleri 1",label:"AÃ§Ä±lÄ±ÅŸ 1",icon:"ðŸŒŸ",parent:"Ã–lÃ¼m & KalÄ±m 1"},{id:"Sente",label:"Sente",icon:"ðŸ—¡ï¸",parent:"AÃ§Ä±lÄ±ÅŸ Prensipleri 1"},{id:"Åžekil",label:"Åžekil",icon:"ðŸ”º",parent:"Sente"}]},{title:"Ä°leri Seviye (11-6k)",levels:[{id:"Joseki",label:"Joseki",icon:"ðŸ“š",parent:null},{id:"Ä°stila",label:"Ä°stila",icon:"ðŸ°",parent:"Joseki"},{id:"SaldÄ±rÄ±",label:"SaldÄ±rÄ±",icon:"âš”ï¸",parent:"Ä°stila"},{id:"Sayma",label:"Sayma",icon:"ðŸ§®",parent:"SaldÄ±rÄ±"}]}];function R(){const p=T.flatMap(l=>l.levels),r={};p.forEach(l=>{r[l.id]={...l}});const u={},o=l=>{if(u[l]!=null)return u[l];const i=r[l];return u[l]=i.parent==null?0:1+o(i.parent),u[l]};p.forEach(l=>o(l.id));const c=[];return p.forEach(l=>{const i=u[l.id];c[i]||(c[i]=[]),c[i].push({...l,depth:i})}),c.filter(Boolean)}const L=R(),q=({allProblems:p})=>{const[r,u]=n.useState(null),[o,c]=n.useState("tree"),[l,i]=n.useState([]),[v,P]=n.useState(null),[d,x]=n.useState(0),[C,j]=n.useState(!1),[E,N]=n.useState({correct:0,wrong:0}),[A,b]=n.useState(!1),[$,y]=n.useState(0);n.useEffect(()=>{(async()=>{const t=localStorage.getItem("goProgress");let a=t?JSON.parse(t):[];i(a);const{data:{user:m}}=await w.auth.getUser();if(m){P(m);const{data:g}=await w.from("user_progress").select("category_id").eq("user_id",m.id);if(g){const k=g.map(f=>f.category_id),h=[...new Set([...a,...k])];i(h),localStorage.setItem("goProgress",JSON.stringify(h))}}})()},[]),n.useEffect(()=>(o==="playing"?document.body.classList.add("fullscreen-mode"):document.body.classList.remove("fullscreen-mode"),()=>document.body.classList.remove("fullscreen-mode")),[o]),n.useEffect(()=>{if(o==="playing"){const s=r?.problems[d],t=s?.solution&&(s.solution.length>0||s.solution.children?.length>0);j(!t)}},[d,o,r]);const K=async s=>{if(!l.includes(s)){const t=[...l,s];if(i(t),localStorage.setItem("goProgress",JSON.stringify(t)),v)try{await w.from("user_progress").insert({user_id:v.id,category_id:s,completed_at:new Date})}catch(a){console.error(a)}}c("result")},z=(s,t)=>{if(t)return alert("Ã–nce bir Ã¶nceki seviyeyi tamamlamalÄ±sÄ±n!");const a=p.filter(m=>m.category===s);if(a.length===0)return alert("Bu kategoride soru yok.");u({id:s,problems:a}),x(0),N({correct:0,wrong:0}),b(!1),y(0),c("playing")},G=()=>{r&&d<r.problems.length-1?(x(s=>s+1),b(!1),y(s=>s+1)):K(r.id)},B=()=>{y(s=>s+1),b(!1)},_=s=>{s?(j(!0),C||N(A?t=>({...t,wrong:t.wrong+1}):t=>({...t,correct:t.correct+1}))):b(!0)},S=r?r.problems[d]:null,Y=r?(d+1)/r.problems.length*100:0;return e.jsxs("div",{className:"game-manager-container",children:[o==="tree"&&e.jsxs("div",{className:"tree-view tree-view-vertical",children:[e.jsxs("header",{className:"tree-header tree-header-leaves",children:[e.jsx("h1",{children:"ðŸŒ³ Go Yetenek AÄŸacÄ±"}),e.jsx("p",{children:"YukarÄ±dan baÅŸla, aÅŸaÄŸÄ± indikÃ§e kÃ¶klere ulaÅŸ."}),!v&&e.jsx("p",{style:{color:"#ef4444",fontSize:"0.9rem"},children:"âš ï¸ Ä°lerlemenizin kaydedilmesi iÃ§in giriÅŸ yapmalÄ±sÄ±nÄ±z."})]}),e.jsx("div",{className:"tree-scroll-container",children:L.map((s,t)=>e.jsx("section",{className:`tree-level tree-level-${t}`,"data-depth":t,children:e.jsx("div",{className:"tree-level-nodes",children:s.map(a=>{const m=a.parent&&!l.includes(a.parent),g=l.includes(a.id),k=p.filter(D=>D.category===a.id).length,h=t===0,f=t===L.length-1;return e.jsxs("div",{className:`tree-node-wrapper ${h?"leaf":""} ${f?"root":""}`,children:[a.parent&&e.jsx("div",{className:`tree-connector ${m?"locked":""}`}),e.jsxs("div",{className:`level-node ${m?"locked":""} ${g?"completed":""} ${h?"leaf-node":""} ${f?"root-node":""}`,onClick:()=>z(a.id,m),children:[e.jsx("div",{className:"node-icon",children:a.icon}),e.jsx("span",{className:"node-badge",children:k})]}),e.jsx("span",{className:"node-label",children:a.label})]},a.id)})})},t))})]}),o==="playing"&&S&&e.jsx("div",{className:"playing-view",children:e.jsx("div",{className:"game-layout",children:e.jsxs("div",{className:"board-section board-section-full",children:[e.jsxs("div",{className:"game-navbar",children:[e.jsxs("h3",{children:[r.id," ",e.jsxs("span",{style:{opacity:.6,fontSize:"0.8em"},children:["(",d+1," / ",r.problems.length,")"]})]}),e.jsx("button",{className:"exit-btn",onClick:()=>c("tree"),children:"âœ• Ã‡Ä±kÄ±ÅŸ"})]}),e.jsx("div",{className:"progress-container",children:e.jsx("div",{className:"progress-fill",style:{width:`${Y}%`}})}),e.jsx(J,{problem:S,onSolve:_,description:S.description||"Bu hamleyi dikkatli dÃ¼ÅŸÃ¼n."},`${d}-${$}`),e.jsxs("div",{className:"game-controls-bottom",children:[e.jsx("button",{className:"control-pill-btn btn-prev",disabled:d===0,onClick:()=>{x(s=>s-1),j(!0)},children:"â† Geri"}),e.jsx("button",{className:"control-pill-btn btn-restart",onClick:B,title:"Yeniden BaÅŸlat",children:"â†º"}),e.jsx("button",{className:"control-pill-btn btn-next",disabled:!C,onClick:G,children:d===r.problems.length-1?"Bitir":"Sonraki â†’"})]})]})})}),o==="result"&&e.jsx("div",{className:"result-overlay",children:e.jsxs("div",{className:"result-card",children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"10px"},children:"ðŸŽ‰"}),e.jsx("h2",{className:"result-title",children:"Tebrikler!"}),e.jsxs("p",{className:"result-subtitle",children:['"',r?.id,'" seviyesini tamamladÄ±n.']}),e.jsxs("div",{className:"stats-row",children:[e.jsxs("div",{className:"stat-box correct",children:[e.jsx("span",{className:"stat-number",children:E.correct}),e.jsx("span",{className:"stat-label",children:"DoÄŸru"})]}),e.jsxs("div",{className:"stat-box wrong",children:[e.jsx("span",{className:"stat-number",children:E.wrong}),e.jsx("span",{className:"stat-label",children:"YanlÄ±ÅŸ"})]})]}),e.jsx("button",{className:"nav-btn",style:{background:"var(--tree-accent)",color:"white",width:"100%",padding:"15px",fontSize:"1.1rem"},onClick:()=>c("tree"),children:"AÄŸaca DÃ¶n ve Devam Et â†’"})]})})]})};export{q as default};
