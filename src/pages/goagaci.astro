---
// pages/goagaci.astro
import GoBoard from '../components/goboard.astro';
import { problemSet } from '../data/problems';
import Layout from "@layouts/Layout.astro";

// --- Ã‡Ã–ZÃœM KONTROL FONKSÄ°YONU ---
const checkHasSolution = (p) => {
  if (!p.solution) return false;
  if (Array.isArray(p.solution)) return p.solution.length > 0;
  if (p.solution.children) return p.solution.children.length > 0;
  return false;
};

// --- MÃœFREDAT YAPISI (AYNI KALIYOR) ---
const treeColumns = [
  {
    title: "BaÅŸlangÄ±Ã§ (20-18k)",
    colorClass: "beginner",
    levels: [
      [{ id: 'Kurallar', parent: null }],          
      [{ id: 'Esir Alma 1', parent: 'Kurallar' }],   
      [{ id: 'Ä°ki GÃ¶z KavramÄ±', parent: 'Esir Alma 1' }],      
      [{ id: 'Nefes YarÄ±ÅŸÄ±', parent: 'Ä°ki GÃ¶z KavramÄ±' }],         
      [{ id: 'Tesuji 1', parent: 'Nefes YarÄ±ÅŸÄ±' }],       
      [{ id: 'Oyunu Bitirme', parent: 'Tesuji 1' }]   
    ]
  },
  {
    title: "Temel TaÅŸlar (17-12k)",
    colorClass: "intermediate",
    levels: [
      [{ id: 'Ã–lÃ¼m & KalÄ±m 1', parent: null }],      
      [
        { id: 'AÃ§Ä±lÄ±ÅŸ Prensipleri 1', parent: 'Ã–lÃ¼m & KalÄ±m 1' },
        { id: 'AÃ§Ä±lÄ±ÅŸ Prensipleri 2', parent: 'Ã–lÃ¼m & KalÄ±m 1' }
      ],  
      [{ id: 'Sente', parent: 'AÃ§Ä±lÄ±ÅŸ Prensipleri 1' }],         
      [{ id: 'Åekil', parent: 'Sente' }],          
      [{ id: 'Ko SavaÅŸÄ±', parent: 'Åekil' }],      
      [{ id: 'AÃ§Ä±lÄ±ÅŸ', parent: 'Ko SavaÅŸÄ±' }]      
    ]
  },
  {
    title: "Ä°leri Seviye (11-6k)",
    colorClass: "advanced",
    levels: [
      [{ id: 'Joseki', parent: null }],            
      [{ id: 'Ä°stila', parent: 'Joseki' }],        
      [{ id: 'SaldÄ±rÄ±', parent: 'Ä°stila' }],       
      [{ id: 'Sayma', parent: 'SaldÄ±rÄ±' }],        
      [{ id: 'Yose', parent: 'Sayma' }],           
      [{ id: 'Dan Seviyesi', parent: 'Yose' }]     
    ]
  }
];

const getCategoryStyle = (cat) => {
  const styles = {
    'Kurallar': { icon: 'ğŸ“–', color: '#3498db' },
    'Esir Alma 1': { icon: 'âš—ï¸', color: '#3498db' },
    'Ä°ki GÃ¶z KavramÄ±': { icon: 'ğŸ‘€', color: '#3498db' },
    'Nefes YarÄ±ÅŸÄ±': { icon: 'ğŸƒ', color: '#3498db' },
    'AÃ§Ä±lÄ±ÅŸ Prensipleri 1': { icon: 'ğŸŒŸ', color: '#f1c40f' },
    'AÃ§Ä±lÄ±ÅŸ Prensipleri 2': { icon: 'â­', color: '#f1c40f' },
    'Tesuji 1': { icon: 'ğŸ”—', color: '#3498db' },
    'Oyunu Bitirme': { icon: 'ğŸ', color: '#3498db' },
    'Ã–lÃ¼m & KalÄ±m 1': { icon: 'ğŸ’€', color: '#f1c40f' },
    'Tesuji': { icon: 'âš¡', color: '#f1c40f' },
    'Sente': { icon: 'ğŸ—¡ï¸', color: '#f1c40f' },
    'Åekil': { icon: 'ğŸ”º', color: '#f1c40f' },
    'Ko SavaÅŸÄ±': { icon: 'ğŸ”„', color: '#f1c40f' },
    'AÃ§Ä±lÄ±ÅŸ': { icon: 'âœ¨', color: '#f1c40f' },
    'Joseki': { icon: 'ğŸ“š', color: '#e74c3c' },
    'Ä°stila': { icon: 'ğŸ°', color: '#e74c3c' },
    'SaldÄ±rÄ±': { icon: 'âš”ï¸', color: '#e74c3c' },
    'Sayma': { icon: 'ğŸ§®', color: '#e74c3c' },
    'Yose': { icon: 'ğŸ‚', color: '#e74c3c' },
    'Dan Seviyesi': { icon: 'ğŸ¥‹', color: '#e74c3c' },
  };
  return styles[cat] || { icon: 'Go', color: '#95a5a6' };
};
---

<Layout title="Go AÄŸacÄ± - Yetenek Yolu">
  <div class="page-wrapper">
    
    <div id="level-map" class="content-grid">
      <aside class="sidebar">
        <div class="sidebar-header"><h3>KazanÄ±mlar</h3></div>
        <div class="sidebar-content">
          {treeColumns.map(col => (
            <div class="course-group">
              <h4 style={`border-left: 4px solid var(--${col.colorClass}-color, #fff)`}>{col.title}</h4>
              <ul>
                {col.levels.map(lvl => (
                  <li><span class="dot"></span>{lvl.map(n => n.id).join(' / ')}</li>
                ))}
              </ul>
            </div>
          ))}
        </div>
      </aside>

      <main class="tree-wrapper">
        <div class="main-header">
           <h1 class="main-title">Go AÄŸacÄ±</h1>
        </div>
        <div class="columns-container">
          {treeColumns.map((col, colIndex) => (
            <div class={`tree-column ${col.colorClass}`}>
              <div class="column-header"><h2>{col.title}</h2><div class="header-line"></div></div>
              <div class="tree-nodes-container">
                {col.levels.map((row, rowIndex) => (
                  <div class="tree-row">
                    {row.map((node) => {
                      const style = getCategoryStyle(node.id);
                      const count = problemSet.filter(p => p.category === node.id).length;
                      return (
                        <div class="tree-node-wrapper">
                          {node.parent && <div class="connector-line"></div>}
                          <div class="level-card locked" id={`node-${node.id.replace(/\s+/g, '-')}-${colIndex}`} data-id={node.id} data-parent={node.parent}>
                            <div class="icon-ring">
                              <div class="level-icon" style={`background-color: ${style.color}`}>{style.icon}</div>
                              <div class="badge">{count}</div>
                              <div class="lock-overlay"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>
                              <div class="check-overlay"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#2ecc71" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></div>
                            </div>
                            <h3>{node.id}</h3>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      </main>
    </div>

    <div id="game-view" style="display: none;">
      
      <div class="game-nav-compact">
        <button id="nav-back-btn" class="back-btn icon-only-mobile">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
          <span class="desktop-text">AÄŸaca DÃ¶n</span>
        </button>
        
        <div class="set-info">
           <h2 id="current-set-title">SET ADI</h2>
           <div class="progress-bar-container">
               <div id="progress-fill" class="progress-fill"></div>
           </div>
        </div>

        <div id="live-score" class="score-badge">0 Puan</div>
      </div>

      <div id="problem-container">
        {problemSet.map((p, index) => (
          <div 
            class="problem-card" 
            data-index={index} 
            data-category={p.category} 
            data-has-solution={checkHasSolution(p).toString()} 
            style="display: none;"
          >
            <div class="problem-header">
              <h3>{p.title}</h3>
              <span class="count-badge">Soru {index + 1}</span>
            </div>
            
            <div class="board-layout">
                <GoBoard problem={p} isTeacher={false}>
                    
                    <div slot="external-controls" class="nav-pill">
                        <button class="nav-minimal-btn prev-btn tooltip" data-tip="Ã–nceki">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                        </button>
                        <div class="nav-sep"></div>
                        <button class="nav-minimal-btn next-btn" disabled={true} data-tip="Sonraki">
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                        </button>
                    </div>

                </GoBoard>

                <div class="info-sidebar">
                  <div class="info-header">
                      <h4 class="info-title">BÄ°LGÄ° KUTUSU</h4>
                  </div>
                  <p class="info-desc">{p.description}</p>
                </div>
            </div>
          </div>
        ))}
      </div>
    </div>

    <div id="result-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div id="result-icon" class="result-icon">ğŸ†</div>
            <h2 id="result-title">Set TamamlandÄ±!</h2>
            <p id="result-message">Harika iÅŸ.</p>
            <div class="score-display">
                <span id="final-score">0</span> / <span id="total-questions">10</span>
            </div>
            <div class="modal-buttons">
                <button id="back-to-map-btn" class="modal-btn secondary">AÄŸaca DÃ¶n</button>
                <button id="retry-level-btn" class="modal-btn secondary">Tekrar Dene</button>
                <button id="next-level-btn" class="modal-btn success" style="display: none;">Sonraki Seviye â”</button>
            </div>
        </div>
    </div>

  </div>
</Layout>

<script>
  import { supabase } from '../lib/supabase';

  // ... (Geri kalan setup ve ses tanÄ±mlarÄ± aynÄ±)
  const gameSounds = {
      stone: new Audio('/sounds/stone.mp3'),
      correct: new Audio('/sounds/correct.mp3'),
      wrong: new Audio('/sounds/wrong.mp3')
  };
  
  function playSound(type: string) {
      const sound = gameSounds[type];
      if (sound) { sound.currentTime = 0; sound.play().catch(e => console.log(e)); }
  }

  // DeÄŸiÅŸkenler
  const levelOrder = ["Kurallar", "Esir Alma 1", "Ä°ki GÃ¶z KavramÄ±", "Nefes YarÄ±ÅŸÄ±", "Tesuji 1", "Oyunu Bitirme", "Ã–lÃ¼m & KalÄ±m 1", "AÃ§Ä±lÄ±ÅŸ Prensipleri 1", "AÃ§Ä±lÄ±ÅŸ Prensipleri 2", "Sente", "Åekil", "Ko SavaÅŸÄ±", "AÃ§Ä±lÄ±ÅŸ", "Joseki", "Ä°stila", "SaldÄ±rÄ±", "Sayma", "Yose", "Dan Seviyesi"];
  let activeProblems: HTMLElement[] = []; 
  let currentIndex = 0;
  let currentScore = 0;
  let currentProblemFailed = false;
  let currentCategory = "";
  let completedSets: string[] = JSON.parse(localStorage.getItem('completedSets') || '[]');
  let currentUser: any = null; 

  document.addEventListener('DOMContentLoaded', async () => {
    await initUserProgress(); 
    updateTreeVisuals();      
    attachEventListeners();   
    attachGameListeners();
    window.addEventListener('unlock-next-problem', () => { (window as any).unlockNextButton(); });
  });

  async function initUserProgress() { /* ... (AynÄ±) ... */ 
    const { data: { user } } = await supabase.auth.getUser(); currentUser = user;
    if (user) {
        const { data } = await supabase.from('user_progress').select('category_id').eq('user_id', user.id);
        if (data) {
            const dbSets = data.map((item: any) => item.category_id);
            completedSets = [...new Set([...completedSets, ...dbSets])];
            localStorage.setItem('completedSets', JSON.stringify(completedSets));
        }
    }
  }
  async function saveProgressToCloud(category: string) { /* ... (AynÄ±) ... */ 
      if (!completedSets.includes(category)) { completedSets.push(category); localStorage.setItem('completedSets', JSON.stringify(completedSets)); }
      if (currentUser) { await supabase.from('user_progress').insert({ user_id: currentUser.id, category_id: category }); }
  }

  function attachEventListeners() { /* ... (AynÄ±) ... */
      document.querySelectorAll('.level-card').forEach(card => { card.addEventListener('click', function(this: HTMLElement) { (window as any).tryOpenLevel(this.getAttribute('data-id'), this.getAttribute('data-parent'), this.id); }); });
      document.getElementById('back-to-map-btn')?.addEventListener('click', (window as any).goToMap);
      document.getElementById('retry-level-btn')?.addEventListener('click', (window as any).retryLevel);
      document.getElementById('nav-back-btn')?.addEventListener('click', (window as any).goToMap);
  }

  function attachGameListeners() {
      document.addEventListener('click', function(e: Event) {
          const target = e.target as HTMLElement; if (!target) return;
          const btn = target.closest('button'); if (!btn) return;
          if (btn.classList.contains('prev-btn')) (window as any).navigate(-1);
          else if (btn.classList.contains('next-btn') && !btn.disabled) (window as any).navigate(1);
      });
  }

  function updateTreeVisuals() { /* ... (AynÄ±) ... */
    document.querySelectorAll('.level-card').forEach(card => {
        const id = card.getAttribute('data-id') || ""; const parent = card.getAttribute('data-parent');
        card.classList.remove('locked', 'unlocked', 'completed');
        if (completedSets.includes(id)) { card.classList.add('completed'); } else if (!parent || parent === 'null' || completedSets.includes(parent)) { card.classList.add('unlocked'); } else { card.classList.add('locked'); }
    });
  }

  // --- OYUN FONKSÄ°YONLARI ---
  (window as any).tryOpenLevel = function(category: string, parent: string | null, elementId: string) {
      if (!parent || parent === 'null' || completedSets.includes(parent)) { (window as any).openLevel(category); } 
      else { const card = document.getElementById(elementId); if(card) { playSound('wrong'); card.classList.add('shake-lock'); setTimeout(() => card.classList.remove('shake-lock'), 500); } }
  };

  (window as any).openLevel = function(category: string) {
    currentCategory = category;
    document.getElementById('level-map')!.style.display = 'none';
    document.getElementById('game-view')!.style.display = 'block';
    const titleEl = document.getElementById('current-set-title'); if(titleEl) titleEl.innerText = category.toUpperCase();
    currentScore = 0;
    const scoreEl = document.getElementById('live-score'); if(scoreEl) scoreEl.innerText = `Puan: 0`;
    (window as any).filterSet(category);
  };

  (window as any).goToMap = function() {
    document.getElementById('result-modal')!.style.display = 'none';
    document.getElementById('game-view')!.style.display = 'none';
    document.getElementById('level-map')!.style.display = 'grid'; 
    updateTreeVisuals(); window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  (window as any).retryLevel = function() { document.getElementById('result-modal')!.style.display = 'none'; (window as any).openLevel(currentCategory); };

  (window as any).handleMoveResult = function(isCorrect: boolean) {
      if (isCorrect) { setTimeout(() => playSound('correct'), 400); (window as any).unlockNextButton(); } 
      else { currentProblemFailed = true; setTimeout(() => playSound('wrong'), 400); }
  };

  (window as any).filterSet = function(category: string) {
    const allCards = Array.from(document.querySelectorAll('.problem-card')) as HTMLElement[];
    activeProblems = allCards.filter(card => card.getAttribute('data-category') === category);
    if (activeProblems.length === 0) { alert(`"${category}" seti boÅŸ!`); (window as any).goToMap(); return; }
    
    activeProblems.forEach(card => { const resetBtn = card.querySelector('.resetBtn') as HTMLElement; if(resetBtn) resetBtn.click(); });
    currentIndex = 0; currentProblemFailed = false;
    
    activeProblems.forEach((card, idx) => {
        const countBadge = card.querySelector('.count-badge') as HTMLElement; if(countBadge) countBadge.innerText = `Soru ${idx + 1} / ${activeProblems.length}`;
        const nextBtn = card.querySelector('.next-btn') as HTMLButtonElement;
        
        // MÄ°NÄ°MALÄ°ST BUTON MANTIÄI
        if(nextBtn) {
            const hasSolution = card.getAttribute('data-has-solution') === 'true';
            if (!hasSolution) { 
                nextBtn.disabled = false; nextBtn.style.opacity = "1"; nextBtn.classList.remove('glow-pill'); nextBtn.style.cursor = "pointer"; nextBtn.classList.add('active');
            } else { 
                nextBtn.disabled = true; nextBtn.style.opacity = "0.5"; nextBtn.classList.remove('glow-pill', 'active'); nextBtn.style.cursor = "not-allowed";
            }
        }
    });
    updateView();
  };

  function updateView() {
    document.querySelectorAll('.problem-card').forEach((c) => (c as HTMLElement).style.display = 'none');
    const currentCard = activeProblems[currentIndex];
    if (currentCard) {
        currentCard.style.display = 'block';

       const infoBox = currentCard.querySelector('.info-sidebar') as HTMLElement;
        
        if (infoBox) {
            infoBox.classList.remove('pop-animation'); 
            void infoBox.offsetWidth; // ArtÄ±k hata vermeyecek
            infoBox.classList.add('pop-animation'); 
        }
    }
    
    const progress = ((currentIndex + 1) / activeProblems.length) * 100;
    const bar = document.getElementById('progress-fill'); if(bar) bar.style.width = `${progress}%`;
  }

  (window as any).navigate = function(direction: number) {
    const newIndex = currentIndex + direction;
    if (!currentProblemFailed && direction === 1) { currentScore++; document.getElementById('live-score')!.innerText = `Puan: ${currentScore}`; }
    if (currentIndex === activeProblems.length - 1 && direction === 1) { (window as any).showResults(); return; }
    if (newIndex >= 0 && newIndex < activeProblems.length) { currentIndex = newIndex; currentProblemFailed = false; updateView(); }
  };

  (window as any).showResults = function() { /* ... (AynÄ±) ... */
      const modal = document.getElementById('result-modal'); const title = document.getElementById('result-title');
      const message = document.getElementById('result-message'); const icon = document.getElementById('result-icon'); const nextBtn = document.getElementById('next-level-btn');
      const total = activeProblems.length; document.getElementById('final-score')!.innerText = String(currentScore); document.getElementById('total-questions')!.innerText = String(total);
      const successThreshold = Math.ceil(total * 0.8);

      if (modal && title && message && icon && nextBtn) {
          if (currentScore >= successThreshold) {
              playSound('correct'); title.innerText = "Set TamamlandÄ±!"; title.style.color = "#2ecc71"; message.innerText = "Tebrikler!"; icon.innerText = "ğŸ†";
              saveProgressToCloud(currentCategory);
              const currentPos = levelOrder.indexOf(currentCategory);
              if (currentPos !== -1 && currentPos < levelOrder.length - 1) { const nextLevelID = levelOrder[currentPos + 1]; nextBtn.style.display = "inline-block"; nextBtn.onclick = function() { modal.style.display = 'none'; (window as any).openLevel(nextLevelID); }; } else { nextBtn.style.display = "none"; }
          } else { playSound('wrong'); title.innerText = "BaÅŸarÄ±sÄ±z"; title.style.color = "#e74c3c"; message.innerText = `En az ${successThreshold} doÄŸru yapmalÄ±sÄ±n.`; icon.innerText = "âŒ"; nextBtn.style.display = "none"; }
          modal.style.display = 'flex';
      }
  };

  (window as any).unlockNextButton = function() {
    const currentCard = activeProblems[currentIndex];
    if (currentCard) {
      const nextBtn = currentCard.querySelector('.next-btn') as HTMLButtonElement;
      if (nextBtn) {
        nextBtn.disabled = false; nextBtn.style.opacity = "1"; nextBtn.style.cursor = "pointer"; 
        nextBtn.classList.add('glow-pill', 'active'); // YeÅŸil yapma ve parlama efekti
      }
    }
  };
</script>

<style>
  /* --- GENEL AYARLAR (DEÄÄ°ÅMEDÄ°) --- */
  .page-wrapper { max-width: 1400px; margin: 0 auto; padding: 10px; font-family: 'Segoe UI', sans-serif; color: var(--text-main); }
  .main-title { font-size: 2.2rem; color: var(--text-main); margin: 0 0 20px 0; text-align: center; }
  .content-grid { display: grid; grid-template-columns: 260px 1fr; gap: 30px; align-items: start; }
  .sidebar { background: var(--sidebar-bg); border: 1px solid var(--sidebar-border); border-radius: 15px; padding: 20px; position: sticky; top: 20px; backdrop-filter: blur(10px); }
  /* ... (Tree styles same) ... */
  .columns-container { display: flex; justify-content: space-between; gap: 20px; }
  .tree-column { flex: 1; display: flex; flex-direction: column; align-items: center; }
  .column-header h2 { font-size: 1.2rem; text-align: center; margin-bottom: 5px; }
  .header-line { width: 50px; height: 3px; margin: 0 auto 40px auto; border-radius: 2px; }
  .tree-column.beginner .header-line { background: var(--beginner-color); }
  .tree-column.intermediate .header-line { background: var(--intermediate-color); }
  .tree-column.advanced .header-line { background: var(--advanced-color); }
  .tree-nodes-container { display: flex; flex-direction: column; gap: 60px; width: 100%; }
  .tree-row { display: flex; justify-content: center; width: 100%; gap: 20px; }
  .tree-node-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; }
  .connector-line { position: absolute; top: -65px; left: 50%; width: 2px; height: 65px; background: rgba(127,140,141,0.3); transform: translateX(-50%); z-index: 0; }
  .level-card { display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: 0.3s; position: relative; z-index: 1; }
  .icon-ring { width: 80px; height: 80px; border-radius: 50%; background: #ecf0f1; border: 4px solid #bdc3c7; display: flex; align-items: center; justify-content: center; position: relative; margin-bottom: 10px; box-shadow: 0 4px 10px var(--shadow-color); }
  .level-icon { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; }
  .badge { position: absolute; top: -5px; right: -5px; background: #34495e; color: #fff; width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; border: 2px solid #fff; }
  .level-card h3 { font-size: 0.9rem; margin: 0; text-align: center; }
  .level-card.locked { opacity: 0.6; cursor: not-allowed; filter: grayscale(100%); }
  .lock-overlay, .check-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); }
  .level-card.completed .icon-ring { border-color: #2ecc71; box-shadow: 0 0 10px rgba(46,204,113,0.5); }

  /* --- OYUN GÃ–RÃœNÃœMÃœ --- */
  .game-nav-compact { display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.25); padding: 8px 15px; border-radius: 12px; margin-bottom: 15px; backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.05); }
  .back-btn { background: rgba(255,255,255,0.1); border: none; color: #fff; padding: 6px 12px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-weight: 600; font-size: 0.9rem; transition: 0.2s; }
  .set-info { display: flex; flex-direction: column; align-items: center; width: 40%; }
  #current-set-title { margin: 0; font-size: 0.9rem; color: #fff; text-transform: uppercase; letter-spacing: 1px; }
  .progress-bar-container { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 4px; overflow: hidden; }
  .progress-fill { height: 100%; background: #3498db; width: 0%; transition: width 0.3s ease; }
  .score-badge { background: #f1c40f; color: #2c3e50; padding: 4px 12px; border-radius: 12px; font-weight: bold; font-size: 0.85rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
  .problem-card { animation: fadeIn 0.4s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  .problem-header { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 5px; }
  .problem-header h3 { margin: 0; font-size: 1.1rem; color: var(--text-main); }
  .count-badge { background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 6px; font-size: 0.8rem; color: var(--text-sub); }
  .board-layout { display: flex; flex-direction: column; align-items: center; gap: 15px; }

  /* 1. MÄ°NÄ°MALÄ°ST BUTON TASARIMI (YENÄ°) */
  .nav-pill {
      display: flex;
      align-items: center;
      background-color: #1a1d21; /* Koyu hap rengi */
      padding: 4px 6px;
      border-radius: 20px;
      border: 1px solid #333;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }

  .nav-minimal-btn {
      background: transparent;
      border: none;
      color: #7f8c8d; /* Pasif gri */
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
  }

  .nav-minimal-btn:hover:not(:disabled) {
      background-color: rgba(255,255,255,0.1);
      color: #fff;
  }

  .nav-minimal-btn.active {
      color: #2ecc71; /* Aktif olduÄŸunda yeÅŸil */
  }
  
  .nav-minimal-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
  }

  .nav-sep {
      width: 1px;
      height: 16px;
      background-color: #444;
      margin: 0 4px;
  }

  .glow-pill {
      box-shadow: 0 0 10px rgba(46, 204, 113, 0.4);
      border-color: #2ecc71;
  }

  /* 2. & 3. Ä°STEK: BALON EFEKTÄ° & BÄ°LGÄ° KUTUSU */
  .info-sidebar {
    width: 90%; max-width: 460px;
    background: rgba(20, 25, 30, 0.9); /* Koyu Arka Plan */
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    padding: 15px;
    text-align: left;
    backdrop-filter: blur(10px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    /* BaÅŸlangÄ±Ã§ durumu */
    transform-origin: center;
  }

  /* Balon ÅiÅŸme Animasyonu */
  @keyframes balloonPop {
      0% { transform: scale(0.8); opacity: 0; }
      60% { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
  }

  .pop-animation {
      animation: balloonPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  }
  
  .info-header { display: flex; align-items: center; justify-content: center; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; }
  .info-title { margin: 0; font-size: 0.9rem; color: #f1c40f; letter-spacing: 1px; font-weight: 700; text-transform: uppercase; }
  .info-desc { margin: 0; font-size: 0.95rem; color: #ecf0f1; line-height: 1.5; text-align: center; }

  @media (min-width: 900px) {
      .board-layout { flex-direction: row; align-items: flex-start; justify-content: center; gap: 40px; }
      .info-sidebar { width: 250px; margin-top: 20px; height: fit-content; position: sticky; top: 20px; }
      .desktop-text { display: inline; }
      .icon-only-mobile { padding-right: 15px; }
  }
  @media (max-width: 900px) {
    .content-grid { grid-template-columns: 1fr; }
    .sidebar { position: relative; top: 0; margin-bottom: 40px; }
    .columns-container { flex-direction: column; }
    .desktop-text { display: none; }
  }
</style>